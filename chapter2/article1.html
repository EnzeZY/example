<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <title>Article 2 | GitBook Example</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 0.5.5">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">
        
    
    
    <meta name="author" content="ramnathv">
    
    
    
    <link rel="prev" href="../chapter2/README.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="../gitbook/style.css">

    
    <link rel="stylesheet" href="../gitbook/plugins/gitbook-plugin-richquotes/plugin.css">
    


        
    <div class="book" data-github="ramnathv/example" data-level="2.1" data-basepath=".." data-revision="1403882683936">
    <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    
    <a href="https://github.com/ramnathv/example" target="_blank" class="btn pull-left home-bookmark" aria-label="GitHub home"><i class="fa fa-bookmark-o"></i></a>
    
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    <span id="font-settings-wrapper">
        <a href="#" class="btn pull-left toggle-font-settings" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="btn-group btn-block">
        <button id="reduce-font-size" class="btn btn-default">A</button>
        <button id="enlarge-font-size" class="btn btn-default">A</button>
    </div>

    <ul class="list-group font-family-list">
        <li class="list-group-item" data-font="0">Serif</li>
        <li class="list-group-item" data-font="1">Sans</li>
    </ul>

    <div class="btn-group btn-group-xs btn-block color-theme-list">
        <button type="button" class="btn btn-default" id="color-theme-preview-0" data-theme="0">White</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-1" data-theme="1">Sepia</button>
        <button type="button" class="btn btn-default" id="color-theme-preview-2" data-theme="2">Night</button>
    </div>
</div>

    </span>

    <!-- Actions Right -->
    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    

    
    <a href="https://github.com/ramnathv/example/stargazers" target="_blank" class="btn pull-right count-star hidden-xs"><i class="fa fa-star-o"></i> Star (<span>-</span>)</a>
    <a href="https://github.com/ramnathv/example/watchers" target="_blank" class="btn pull-right count-watch hidden-xs"><i class="fa fa-eye"></i> Watch (<span>-</span>)</a>
    

    <!-- Title -->
    <h1>
        <i class="fa fa-spinner fa-spin"></i>
        <a href="../" >GitBook Example</a>
    </h1>
</div>

    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Search" class="form-control" />
    </div>
    <ul class="summary">
        
        
        
        <li>
            <a href="https://github.com/ramnathv" target="blank" class="author-link">About the author</a>
        </li>
        

        
        
        <li>
            <a href="https://github.com/ramnathv/example/issues" target="blank"class="issues-link">Questions and Issues</a>
        </li>
        

        
        
        <li>
            <a href="https://github.com/ramnathv/example/edit/master/chapter2/article1.md" target="blank" class="contribute-link">Edit and Contribute</a>
        </li>
        

        
        <li class="divider"></li>
        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="../index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="chapter1/README.html">
            
                
                    <a href="../chapter1/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         Chapter 1
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="1.1" data-path="chapter1/article1.html">
            
                
                    <a href="../chapter1/article1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.1.</b>
                        
                         Article 1
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="chapter2/README.html">
            
                
                    <a href="../chapter2/README.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Chapter 1
                    </a>
                
            
            
            <ul class="articles">
                
    
        
        <li class="chapter " data-level="2.1" data-path="chapter2/article1.html">
            
                
                    <a href="../chapter2/article1.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.1.</b>
                        
                         Article 2
                    </a>
                
            
            
        </li>
    

            </ul>
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Generated using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="page-wrapper" tabindex="-1">
                <div class="book-progress">
    <div class="bar">
        <div class="inner" style="width: 100%;min-width: 75%;"></div>
    </div>
    <div class="chapters">
    
        <a href="../index.html" title="Introduction" class="chapter done new-chapter" data-progress="0" style="left: 0%;"></a>
    
        <a href="../chapter1/README.html" title="Chapter 1" class="chapter done new-chapter" data-progress="1" style="left: 25%;"></a>
    
        <a href="../chapter1/article1.html" title="Article 1" class="chapter done " data-progress="1.1" style="left: 50%;"></a>
    
        <a href="../chapter2/README.html" title="Chapter 1" class="chapter done new-chapter" data-progress="2" style="left: 75%;"></a>
    
        <a href="../chapter2/article1.html" title="Article 2" class="chapter done " data-progress="2.1" style="left: 100%;"></a>
    
    </div>
</div>

                <div class="page-inner">
                
                    <section class="normal" id="section-gitbook_5">
                    
                        <h2 id="how-rcharts-works-">How rCharts Works?</h2>
<blockquote class="clearfix alert alert-info"><strong class="fa fa-4x fa-edit"></strong>
<p> This is a multi-part series on how rCharts works. My objective is to show you how easy it is to integrate a javascript visualization library into rCharts, and take advantage of a single-unified interface and other functionalities. </p>
</blockquote>
<p>In this tutorial, I will go over the steps to integrate <a href="http://imaginea.github.io/uvCharts/" target="_blank">uvCharts</a>, a new-entrant to the rapidly expanding set of wrapper libraries to <a href="http://d3js.org" target="_blank">d3js</a>. Specifically, we will recreate this barchart, which was created using uvCharts.</p>
<iframe style="width: 100%; height: 600px" src="http://jsfiddle.net/RR8Ub/1/embedded/result,resources,js,html" seamless="" frameborder="0">
</iframe>

<p>Browse through the <code>resources</code>, <code>javascript</code> and <code>html</code> tabs in the jsFiddle to get a sense of how the chart works.  rCharts will need to create each of these sections, and we will go through them one by one.</p>
<h3 id="resources">Resources</h3>
<p>The resources required by a chart include the external javascript <code>&lt;script src = &quot;...js&quot;&gt;</code> and css files <code>&lt;link href=&quot;...css&quot; rel=&quot;stylesheet&quot;&gt;</code> that are included either in the head of the html document or at the end. rCharts uses a convention over configuration approach, and so the resources are specified using a <code>config.yml</code> file as shown below.</p>
<p>The <a href="libraries/widgets/uvcharts/config.yml">config</a> file basically provides paths to the js/css files, both locally and  online from a cdn. The <code>jshead</code> key specifies that these js files need to be included in the head of the document.</p>
<pre><code class="lang-yaml">uvcharts:
  jshead: [js/d3.v3.min.js, js/uvcharts.js]
  cdn:
    jshead:
      - &quot;http://cdnjs.cloudflare.com/ajax/libs/d3/3.2.2/d3.v3.min.js&quot;
      - &quot;http://imaginea.github.io/uvCharts/js/uvcharts.js&quot;
</code></pre>
<p>At this point, the <code>uvCharts</code> library folder will look like this</p>
<ul class="tree" id="tree">
  <li>js
    <ul>
      <li>d3.v3.min.js</li>
      <li class="last">uvcharts.js</li>
    </ul>
  </li>
  <li class="last">config.yml</li>
</ul>

<p><br></p>
<h3 id="javascript">Javascript</h3>
<p>Our next step is to split the javascript for the chart into a <a href="http://mustache.github.io/" target="_blank">mustache</a> layout, and then populate it using a <code>json</code> payload processed by R.</p>
<iframe style="width: 100%; height: 600px" src="http://jsfiddle.net/RR8Ub/1/embedded/js" seamless="" frameborder="0">
</iframe>


<p>By default, <code>rCharts</code> bundles all data and parameters into a single json variable <code>chartParams</code>. In addition to <code>chartParams</code>, it also sends <code>chartId</code> to the layout. So, we begin by replacing all data in the javascript with a placeholder <code>{{{ chartParams }}}</code>.  rCharts uses the <code>whisker</code> package to replace <code>{{{ chartParams }}}</code> with the json payload.</p>
<h4 id="layout">Layout</h4>
<pre><code class="lang-html"><span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
  <span class="hljs-keyword">var</span> graphdef = {{{ chartParams }}}
  <span class="hljs-keyword">var</span> config = {
    meta: {
      position: <span class="hljs-string">"#{{ chartId }}"</span>
    }
  }
  <span class="hljs-keyword">var</span> chart = uv.chart(graphdef.type, graphdef, config)
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
</code></pre>
<p>Following rCharts conventions, we save this layout to <code>layouts/chart.html</code>.
At this point our <a href="libraries/widgets/uvCharts">uvCharts</a> library folder is going to look like this </p>
<ul class="tree" id="tree">
  <li>js
    <ul>
      <li>d3.v3.min.js</li>
      <li class="last">uvcharts.js</li>
    </ul>
  </li>
  <li>layouts
    <ul>
      <li class="last">chart.html</li>
    </ul>
  </li><li class="last">config.yml</li>
</ul>

<p><br></p>
<h4 id="payload">Payload</h4>
<p>Different d3js wrapper libraries tend to use different data structures. Our goal with <code>rCharts</code> is to provide a single-unified interface for specifying a chart, so that a user does not need to worry about the underlying format used by a specific library. This can be easily achieved by writing functions that transform data (usually a <code>data.frame</code>) to different formats, as required by the library.</p>
<p>Shown below is the dataset that we will be working with. We need to convert it into an R object, that when converted to JSON will look like the object <code>dataset</code> seen in the <code>javascript</code> shown above.</p>
<pre><code class="lang-r">hair_eye_male &lt;- subset(as.data.frame(HairEyeColor), Sex == <span class="hljs-string">"Male"</span>)
head(hair_eye_male)
</code></pre>
<pre><code>   Hair   Eye  Sex Freq
1 Black Brown Male   32
2 Brown Brown Male   53
3   Red Brown Male   10
4 Blond Brown Male    3
5 Black  Blue Male   11
6 Brown  Blue Male   50
</code></pre><p>We will now write a data transformation function in R that takes <code>x</code>, <code>y</code>, <code>data</code> and <code>group</code> as inputs, and returns a data structure that when converted to JSON will match what we need. The basic idea behind <code>make_dataset</code> is to (a) rename the <code>x</code>, <code>y</code> columns to <code>name</code>, <code>value</code>, (b) split the <code>data</code> based on <code>group</code> and (c) convert each piece into a JSON array.</p>
<pre><code class="lang-r">data_to_json &lt;- <span class="hljs-keyword">function</span>(x, y, data, group = <span class="hljs-literal">NULL</span>){
  <span class="hljs-keyword">require</span>(plyr)
  dat &lt;- rename(data, setNames(c(<span class="hljs-string">'name'</span>, <span class="hljs-string">'value'</span>), c(x, y)))
  dat &lt;- dat[c(<span class="hljs-string">'name'</span>, <span class="hljs-string">'value'</span>, group)]
  <span class="hljs-keyword">if</span> (!is.null(group)){
    dlply(dat, group, toJSONArray, json = <span class="hljs-literal">F</span>)
  } <span class="hljs-keyword">else</span> {
    list(main = toJSONArray(dat, json = <span class="hljs-literal">F</span>)) 
  }
}
</code></pre>
<p>You can run the code below to check that it produces the same <code>dataset</code> variable seen in the javascript above.</p>
<pre><code class="lang-r">dataset = data_to_json(<span class="hljs-string">'Hair'</span>, <span class="hljs-string">'Freq'</span>, hair_eye_male, group = <span class="hljs-string">'Eye'</span>)
cat(RJSONIO::toJSON(dataset))
</code></pre>
<h3 id="chart-creation">Chart Creation</h3>
<p>It is now time to create the chart from R. We initialize the chart as an instance of <code>rCharts</code>, use the <code>setLib</code> method to point to the location of the library folder, and then pass the data payload using the <code>set</code> method. </p>
<pre><code class="lang-r"><span class="hljs-keyword">library</span>(rCharts)
u1 &lt;- rCharts$new()
u1$setLib(<span class="hljs-string">"uvcharts"</span>)
u1$set(
  type = <span class="hljs-string">'Bar'</span>,
  categories = names(dataset),
  dataset = dataset,
  dom = <span class="hljs-string">'chart1'</span>
)
u1
</code></pre>
<p><iframe src=" figure/unnamed-chunk-4.html " scrolling="no" frameborder="0" seamless="" class="rChart uvcharts " id="iframe-" chart1=""></iframe> <style>iframe.rChart{ width: 100%; height: 400px;}</style></p>
<p>For the above code to work, you need to make sure that you have <a href="https://github.com/rcharts/howitworks/zipball/gh-pages" target="_blank">downloaded</a> this repo, and are referring to the correct path to the <code>uvCharts</code> library.</p>
<p>Alternately, you can point to the online version of the library <code>http://rcharts.github.io/howitworks/libraries/widgets/uvcharts</code> in <code>setLib</code>, and not have to download anything!!</p>
<p>You could save all this code in an file named <a href="assets/code/mychart.R">myChart.R</a> and then publish the chart along with the code by running the code below. The published chart can be seen <a href="http://rcharts.io/viewer/?3b61ed669d7f15156520" target="_blank">here</a></p>
<p>For many libraries rCharts already simplifies the steps.  Similarly, you can simplify the chart creation interface further, by wrapping everything into a <code>uPlot</code> function</p>
<pre><code class="lang-r">uPlot &lt;- <span class="hljs-keyword">function</span>(x, y, data, group = <span class="hljs-literal">NULL</span>, <span class="hljs-keyword">...</span>){
  dataset = data_to_json(x = x, y = y, data = data, group = group)
  u1 &lt;- rCharts::rCharts$new()
  u1$setLib(<span class="hljs-string">"uvcharts"</span>)
  u1$set(
    categories = names(dataset),
    dataset = dataset,
    <span class="hljs-keyword">...</span>
  )
  <span class="hljs-keyword">return</span>(u1)
}
</code></pre>
<p>Let us create a <code>StackedBar</code> chart using <code>uPlot</code></p>
<pre><code class="lang-r">uPlot(<span class="hljs-string">"Hair"</span>, <span class="hljs-string">"Freq"</span>, 
  data = hair_eye_male, 
  group = <span class="hljs-string">"Eye"</span>,
  type = <span class="hljs-string">'StackedBar'</span>
)
</code></pre>
<p><iframe src=" figure/stackedbar.html " scrolling="no" frameborder="0" seamless="" class="rChart uvcharts " id="iframe-" chart4a5265de02d0=""></iframe> <style>iframe.rChart{ width: 100%; height: 400px;}</style></p>
<p>So you can see for yourself, how easy it is to integrate a javascript visualization library into <code>rCharts</code>. </p>
<p>The <a href="http://imaginea.github.io/uvCharts/documentation.html" target="_blank">uvCharts</a> API provides more functionality to customize the chart. While, we can use nested lists with the <code>set</code> method to access this functionality, it would be cleaner to write custom methods that follow the unified interface and make things easier. We will go over this in Part 2 of this series.</p>
<h3 id="acknowledgements">Acknowledgements</h3>
<p>I would like to thank <a href="http://github.com/timelyportfolio" target="_blank">TimelyPortfolio</a> for his valuable suggestions and comments, which helped improve this post.</p>
<style>
 iframe.rChart{height: 500px;}
 p {
     text-align: justify;
     font-size: 16px;
     line-height: 24px;
     color: #333333;
 }
</style>


                    
                    </section>
                
                </div>
            </div>
        </div>

        
        <a href="../chapter2/README.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: Chapter 1"><i class="fa fa-angle-left"></i></a>
        
        
    </div>
</div>

        
<script src="../gitbook/jsrepl/jsrepl.js" id="jsrepl-script"></script>
<script src="../gitbook/app.js"></script>

    
    <script src="../gitbook/plugins/gitbook-plugin-disqus/plugin.js"></script>
    

    
    <script src="http://cdn.mathjax.org/mathjax/2.0-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

    
    <script src="../gitbook/plugins/gitbook-plugin-livereload/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"richquotes":{"todos":true},"disqus":{"shortName":"slidify"},"fontSettings":{"theme":"night","family":"sans","size":3}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>
